---
# https://github.com/telekom-mms/kavir
pages:
  stage: deploy
  image: ghcr.io/telekom-mms/kavir-html-report-builder:1.0.0
  variables:
    ## optional env vars
    # verbose:                       # default: true
    # report_name:                   # default: Kubernetes Application Version Report
    # report_scope:                  # default: deployments replicasets statefulsets daemonsets jobs cronjobs replicationcontrollers
    # paths_templateFile:            # default: /etc/kavir-html-report-builder/templates/simple.html.j2
    # paths_styleFile:               # default: /etc/kavir-html-report-builder/styles/simple.css
    # menu_enabled:                  # default: true
    ## mandatory env vars
    paths_srcDir: kavir-csv-reports
    paths_outDir: public             # do not change
    menu_linkBasePath: $CI_PAGES_URL # do not change
  script:
    - mkdir -p $paths_srcDir
    - mkdir -p public
    # move all folders that should be included in the html report to $paths_srcDir
    - mv dev $paths_srcDir
    - mv prod $paths_srcDir
    # build the html reports
    - /bin/bash /opt/kavir-html-report-builder/entrypoint.bash
    # copy (not move!) the html report that should be the landing page to public/index.html
    - cp public/prod.html public/index.html
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
  artifacts:
    paths:
      - public
